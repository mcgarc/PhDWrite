% TODO
\cm{Need to check this intro, but it is dependent on the context of this and
previous chapters, so revisit later.}
In the previous chapter I described how a microwave resonator can be used for
coherent control of a strongly-coupled ensemble of cold molecules. Now I will
expand on this to demonstrate how such a system can be used for the creation of
non-classical states for use in quantum metrology \cm{etc...}

I will begin with a description of the interaction of a spin ensemble with
light in a cavity. I will then show that using such a system it is possible to
entangle the spin state of the ensemble with the light exiting the cavity.
Measuring the light state therefore provides a means of measuring the spin
state whilst maintaing coherence of the spins. I will go on to show that
performing such a measurement can be used to generate an entangled spin state,
with emphasis on the spin squeezed state.

\section{Cavity quantum electrodynamics}

\subsection{Single spin in a cavity}

Consider a spin-half system with ground and excited states $\ket{g}$
and $\ket{e}$ respectively, with a transition frequency $\omega_0$. These
states are eigenstates of the spin operator $s_z = \sigma_z /2$ where
$\sigma_j$ represents the Pauli matrix, and $j\in \{x,y,z\}$.

When such a spin interacts with a mode of an optical cavity of frequency
$\omega_c$, the behaviour is described by the familiar Jaynes-Cummings
Hamiltonian in the rotating wave approximation~\cite{}
%
\begin{equation}
  H_\text{JC} = \hbar\omega_c a^\dagger a + \hbar \omega_0 s_z +
  \frac{\hbar\Omega}{2}(a^\dagger \sigma_- + a\sigma_+)
  \label{squeeze:eqn:JCH}
\end{equation}
%
where $a$ ($a^\dagger$) is the annihilation (creation) operator of the photons,
$\Omega = 2g$ is the Rabi frequency of the interaction, and $\sigma_\pm =
(\sigma_x \pm i\sigma_y)/2$ are the raising and lowering operators of spin. The
detuning of the cavity resonance from that of the spin is $\Delta = \omega_0 -
\omega_c$.

% TODO Ensure that this para is in the right place and that we include
% definition of 2g = \Omega
The number of photons in the cavity is $n$, the eigenvalue of the number
operator $a^\dagger a$.  Light is coupled out of the cavity with some decay
rate $\kappa = \omega_c/Q$, with $Q$ being the cavity's quality factor. The
spin can decay into other modes at some decay rate $\gamma$. We assume that we
are in the strong coupling r\'egime, so that such decays can be neglected. In
this case $g \gg \kappa, \gamma$.~\cite{PhysRevA.69.062320}.

We shall also assume that we have some control over $\omega_0$ and hence also
the detuning $\Delta$. Consider the dispersive r\'egime, where  $g\ll|\Delta|$.
Reference~\cite{PhysRevA.69.062320} tells us that we can gain insight into the
dispersive behaviour by applying  a unitary transformation
%
\begin{equation} U = \exp \left[\frac{g}{\Delta}(a\sigma_+ -
a^\dagger\sigma_-)\right] \end{equation}
%
up to second order in $g/\Delta$. From this we obtain
%
\begin{equation} H= UH_\text{JC}U^\dagger \approx \hbar \omega_c
  a^\dagger a + \hbar\left(\omega_c +
  \frac{g^2}{\Delta}\right)s_z + \frac{\hbar
  g^2}{\Delta}\sigma_z a^\dagger a.  \end{equation}
%
These three terms describe the oscillation of light in the cavity, the energy
of the spin and the interaction of the photons with the spin. Note that the
interaction of the photons and the spins induces the usual AC start shift
proportional to $(n+\frac{1}{2})$. The last term is what will ultimately allow
us to perform QND measurement, since it will enable exchange of information
between the z-component of the spin with the photons.

\subsection{Spin ensemble Hamiltonian}

We are interested in the case where there are $N\gg1$ spins in the
cavity. Assume that the coupling between each spin and the resonator photons is
the same (that is, the coupling is homogeneous), then the ensemble is described
by the Tavis-Cummings Hamiltonian~\cite{Kirton2019}
% CITE https://arxiv.org/pdf/1805.09828.pdf
%
\begin{equation}
  H_\text{TC}=  \hbar \omega_c a^\dagger a + \sum_{i=1}^N\left[
    \frac{\hbar\omega_0}{2}\sigma_z^i +\frac{\hbar\Omega}{2\sqrt{N}}(a^\dagger
    \sigma^i_- + a\sigma^i_+)\right]
\end{equation}
%
in direct analogy to~\myeqref{squeeze:eqn:JCH}, where $\sigma_*^i$ to refers
to the pauli or ladder operator acting on the $i^\text{th}$ spin.

We also define for the $i^\text{th}$ spin
%
\begin{equation}
  \mathbf{s}^i = \frac{1}{2}\begin{bmatrix} \sigma^i_x \\ \sigma^i_y \\ \sigma^i_z
\end{bmatrix}
\end{equation}
%
and a collective spin operator
%
\begin{equation}
\mathbf{S} = \sum_{i=1}^N \mathbf{s}^i.
\end{equation}
%
We will usually be interested in the eigenstates of $S_z$ which we denote in
the usual way as $\ket{S, m}$, with $S^2 \ket{S,m} = S(S+1)\ket{S, m}$ and $S_z
\ket{S,m} = m\ket{S, m}$. These are the Dicke states~\cite{}, and in
section~\ref{squeeze:QNDsqueeze} we will show that they are entangled states of
the spin system. The raising and lowering operators are $S_\pm = (S_x
\pm iS_y)/2 = \sum_{i=1}^N\sigma_\pm^i/\sqrt{N}$.
%
Now rewrite the Hamiltonian for the ensemble as
%
\begin{equation}
  H_\text{TC} = \hbar\omega_c a^\dagger a + \hbar\omega_0 S_z +
  \frac{\hbar\Omega}{2}(a^\dagger S_- + aS_+)
\end{equation}
%
which I assert can now be transformed similarly to the single-spin case by the
operator
%
\begin{equation}
  U_\text{E} = \exp \left[\frac{g}{\Delta}(aS_+ - a^\dagger S_-)\right]\
\end{equation}
%
for new Hamiltonian
%
\begin{equation}
  H_\text{E}= U_\text{E}H_\text{TC}U_\text{E}^\dagger \approx 
    \hbar \omega_c a^\dagger a + 
    \hbar\left(\omega_c + \frac{g^2}{\Delta}\right)S_z + 
    \frac{\hbar g^2}{\Delta}S_z a^\dagger a.
  \label{eqn:He}
\end{equation}

This assertion is valid since the mathematics of the transformation is exactly
the same as for the single-spin case. The operator $\mathbf{S}$ has the same
commutation relations as the analogous $\mathbf{s}^i$. Once again, the final
term will allow the information transfer for our QND measurements.

\subsection{Spin states of the ensemble}

We can represent the state of the individual spins on a Bloch sphere in the
usual way, that is by writing the state in the form~\cite{PhysRevA.47.3554}
%
\begin{equation}
  \ket{\psi(\theta, \phi)}_i = \cos\left(\frac{\theta_i}{2}\right)\ket{e}_i +
  e^{i\phi_i}\sin\left(\frac{\theta_i}{2}\right)\ket{g}_i.
  \label{eqn:blochspin}
\end{equation}
%
The angles $\theta_i$ and $\phi_i$ now define a point on a sphere of unit
radius with $\ket{e}_i$ and $\ket{g}_i$ at the poles. The cartesian
representation is given by the expectation value $\langle \mathbf{s}_i
\rangle$.


The spin state of the ensemble is
%
\begin{equation}
  \ket{\Psi} = \bigotimes_{i=1}^N \ket{\psi}_i.
\end{equation}
%
Such a state can also be represented on a sphere as the sum of all the
individual spin vectors. In this case the radius of the sphere is variable, but
we will limit ourselves to the case where 
all spins are aligned.
We therefore have that for all $i$, $\theta_i = \theta$ and $\phi_i = \phi$ and the
sphere has radius $N/2$. Such a state is known as a coherent spin state
(CSS)~\cite{MA201189, Gazeau2009}.

In such a case it is useful to consider a system where
all spins are initially in, for example, the ground state. They then undergo
the same uniform rotation into the desired state $\ket{\psi(\theta, \phi)}_i$,
which we write as
%
\begin{equation}
  \ket{\Psi(\theta,\phi)} = \mathcal{R}(\theta, \phi)\ket{g}
\end{equation}
%
where $\ket{g} = \bigotimes_{i=1}^N\ket{g}_i$ and similarly for $\ket{e}$. We
represent this visually on the Bloch sphere, in analogy with the single spin
case, as illustrated in Fig.~\ref{CSSbloch}. Again we can represent the vector
in a cartesian form as the expectation value $\langle \mathbf{S} \rangle$. 

% TODO Need to do my own version of this figure to show single spin bloch
% sphere, 

It is also useful to denote the state in terms of the
eigenstates of the angular momentum operator. In particular, the eigenstate of
$S_z$, denoted $\ket{S, m}$ can be used to describe a CSS
%
\begin{equation}
  \ket{\Psi} = \sum_{m=-S}^S a_m \ket{S, m}
\end{equation}
where $a_m$ are the probability amplitudes. Note that $\ket{e} = \ket{S, S}$
and $\ket{g} = \ket{S, -S}$.
%
The general form of $a_m$ can be found in \inlineref{PhysRevA.6.2211}, but we
consider specifically the CSS aligned along the $x$ axis, so that $\theta =
\pi/2$ and $\phi = 0$. We denote such a state as
%
\begin{equation}
  \ket{+} = \bigotimes_{i=1}^N \ket{+}_i.
\end{equation}

\begin{figure}
  \centering
  \includegraphics[width=0.4\textwidth]{figs/squeeze/CSS_Bloch_Cox.png}
  %
  \includegraphics[width=0.5\textwidth]{figs/squeeze/squeezed_Bloch_Cox.png}
  \caption{Left: A coherent spin state as represented on the Bloch sphere.
  Right: Comparison of a CSS and squeezed state as represented on the Bloch
  sphere. Note the reduced uncertainty in the z direction.
  Both reproduced from~\cite{Cox2016}}
  \label{CSSbloch}
  % TODO Redo this, see earlier TODO
\end{figure}

Direct measurement of any individual spin in $\ket{+}$ would yield $\ket{e}_i$
or $\ket{g}_i$ with probability $p=1/2$. Hence measuring the eigenvalue of
$S_z$ will give a value $m$ with probabilty given by the binomial
theorem~\cite{Gazeau2009}
%
\begin{equation}
  P(m) = \frac{1}{2^N} \binom{N}{m+N/2}
\end{equation}
%
or for large $N$, the binomial is approximated by the Gaussian
%
\begin{equation}
  P(m) \approx\frac{1}{\sqrt{2\pi \Delta_N^2}} e^{-m^2/(2\Delta_N^2)}.
  \label{eqn:CSSmprob}
\end{equation}
%
where the variance is $\Delta_N^2 = N/4$. We therefore rewrite the probability
amplitudes of $\ket{+}$ so that
%
\begin{equation}
  \ket{+} = \sum_{m=-S}^S \sqrt{P(m)}\ket{S,m}.
  \label{squeeze:eqn:plusdicke}
\end{equation}

Note that such a state has expectation values $\langle S_z \rangle = 0$,
$\langle S_z^2\rangle = \Delta_N^2$, and the uncertainty in $S_z$ is consistent
with the usual formula $\Delta_N^2 = \langle S_z^2 \rangle - \langle
S_z\rangle^2$. This uncertainty is the projection noise of a CSS, arising from
the uncertainty in the measurement of the individual spins. We can understand
this in terms of an uncertainty in the cartesian Bloch vector $\langle
\mathbf{S} \rangle$, or as an uncertainty in $\theta$~\cite{PhysRevA.47.3554}
%
\footnote{This can be shown geometrically: consider the angle on the Bloch
sphere between the x-axis and the arrow representing the CSS, call this
$\theta'$ and assume it to be small. Then $\sin
\theta' \approx \tan \theta' = m/S \approx \theta'$. Differentiating both sides
with respect to theta gives $\Delta m / \Delta \theta \approx 1/S$, noting that
$\Delta \theta' = \Delta \theta$.
}
%
\begin{equation}
  \Delta\theta = \frac{1}{\sqrt{N}}
\end{equation}
which is known as the standard quantum limit (SQL). By symmetry $\Delta \phi =
\Delta \theta$ (corresponding to uncertainty in $S_y$).

Note that these uncertainties hold only for $\ket{+}$ and other states where
$\theta = \pi$ (states on the equator of the Bloch sphere). For example in the
cases of $\ket{e}$ and $\ket{g}$, $\Delta \theta = 0$~\cite{PhysRevA.47.3554}.

\subsection{Quantum non-demolition measurement of the spin state}

A useful tool for quantum information processing is the quantum non-demolition
(QND) measurement~\cite{}. Such a measurement allows the inspection of the
state of a system (in this case the spin ensemble) while preserving some
quantum coherence. QND measurements can be deployed not only for state readout,
but for the preparation of non-classical states, as will be explained in the
following sections. The QND method described here has been demonstrated to work
in superconducting qubits~\cite{PhysRevA.69.062320} and expands on the proposal
in \cite{Andre2006}.

Consider the spin ensemble coupled to resonator photons as described above, and
initialised in the state $\ket{+}$ ($a_m = \sqrt{P(m)}$). Take the resonator
photons to be in a canonical coherent state~\cite{Gazeau2009}
%
\begin{equation}
  \ket{\alpha} = e^{-\frac{|\alpha|^2}{2}}\sum_{n=0}^\infty \frac{\alpha^n}{\sqrt{n!}} \ket{n}
\end{equation}
%
with $\alpha\in\mathbb{C}$, and $\ket{n}$ here representing the $n^\text{th}$
Fock state of the light~\cite{agarwal2012}. We say that the pulse of light lasting time
$t=T$ and  write the state of the system at time $t=0$ as
%
\begin{equation}
  \ket{\Psi(0)} = \sum_{m=-S}^S \sqrt{P(m)} \ket{S, m}\ket{\alpha}.
\end{equation}
%
We take this state to evolve in a rotating reference frame, such that
%
\begin{equation}
  \ket{\Psi(T)} = \exp\left(-iH_\text{int}T/\hbar\right)\ket{\Psi(0)}
\end{equation}
%
where the interaction Hamiltonian is
%
\begin{equation}
  H_\text{int} = \hbar \frac{g^2}{\Delta} S_z a^\dagger a.
\end{equation}
%
After the pulse, we therefore have the state
%
\begin{equation}
  \ket{\Psi(T)} = \sum_{m=-S}^S \sqrt{P(m)} e^{-i\nu T S_z
  a^\dagger a} \ket{S, m}\ket{\alpha}
\end{equation}
%
with $\nu = g^2/\Delta$. It is now straightforward to show that
the state of the spin ensemble is entangled with the state of the light field,
by writing $\ket{\alpha}$ in terms of the summation over Fock states
%
\begin{align}
  \ket{\Psi(T)} &= e^{-\frac{|\alpha|^2}{2}}\sum_{m=-S}^S \sum_{n=0}^\infty \sqrt{P(m)}
   \frac{\alpha^n}{\sqrt{n!}} e^{-i\nu T S_z a^\dagger a} \ket{S, m} \ket{n}
   \\
  &= e^{-\frac{|\alpha|^2}{2}}\sum_{m=-S}^S \sum_{n=0}^\infty \sqrt{P(m)}
  \frac{\alpha^n}{\sqrt{n!}} e^{-i\nu Tm n} \ket{S, m} \ket{n} \\
  &= \sum_{m=-S}^S \sqrt{P(m)} \ket{S, m} \left( e^{-\frac{|\alpha|^2}{2}}
  \sum_{n=0}^\infty \frac{(\alpha e^{-i\nu T m})^n}{\sqrt{n!}}\ket{n}\right)
  \\
  &= \sum_{m=-S}^S \sqrt{P(m)} \ket{S, m}\ket{\alpha e^{-i\nu T m}}.
\end{align}

It is now clear measuring the phase of the light leaving the cavity
(for example with a homodyne detector) will tell us something about
the state of the ensemble. Notably, the information gained tells us only about
the entire state of the ensemble, and not about any individual spins. Therefore
the quantum coherence is conserved throughout this process.
% TODO I'm not convinced by this assertion. CITE? Actually check... 

\subsection{Homodyne measurement}

% TODO Homodyne figure
As mentioned above, the phase of the light can be determined by a homodyne
measurement ~\cite{agarwal2012}, as illustrated in Fig.  \ref{fig:homodyne}.
The phase-shifted light transmitted through the cavity is incident on one port
(a) of the beam splitter (we label this light $\ket{\Psi_a}$). On the other
port (b) we have a strong local oscillator (LO) in a coherent state
$\ket{\beta}$. We assume the LO has large amplitude ($|\beta|
\gg |\alpha|$) and has phase $-\varphi$, which we set relative to the phase of
alpha, so that $\arg(\alpha)=0$.
% TODO Need to account for transmission coefficient but probably later, see
% Mauro's paper (Q. Tomography), eqn. 2.37 - 2.42

The annihilation operators associated with the input ports are related to those
of the output ports (c and d) by the usual relation for a balanced beam
splitter~\cite{agarwal2012}
%
\begin{equation}
  \label{squeeze:eqn:bsmat}
  \begin{pmatrix} c \\ d \end{pmatrix} = \frac{1}{\sqrt{2}}\begin{pmatrix}
    1 & i \\ i & 1 
  \end{pmatrix}  \begin{pmatrix} a \\ b \end{pmatrix}.
\end{equation}
%
The difference in the expected photon numbers arriving at each
detector is
% TODO Need to introduce this a -> kappa a thing here, from I/O formalism, but
% I lost the paper I need for the cite and explanation..
\begin{align}
  \langle c^\dagger c - d^\dagger d\rangle &= i
  \bra{\Psi_a}\bra{\beta}(a^\dagger b-
  ab^\dagger)\ket{\beta}\ket{\Psi_a} \\
  & = i|\beta|\kappa \bra{\Psi_a}(a^\dagger e^{i\varphi} - a
  e^{-i\varphi})\ket{\Psi_a} \\
  &= 2|\beta|\kappa\bra{\Psi_a}(Y\cos\varphi - X\sin\varphi)\ket{\Psi_a} \\
  &= 2|\beta|\kappa\bra{\Psi_a}(X\sin(\varphi+\frac{\pi}{2}) +
  Y\cos(\varphi+\frac{\pi}{2}))\ket{\Psi_a}.
  \label{squeeze:eqn:homoquads}
\end{align}
%
The last equality introduces the canonical quadratures of the light field,
corresponding to its real and imaginary parts. They are defined
by~\cite{gerry_knight_2004}
\begin{align}
  X = \frac{a + a^\dagger}{2} && Y = \frac{a - a^\dagger}{2i}.
\end{align}

Hence measuring the intensity of each output of the beamsplitter can give us
information on the phase of the light. We choose $\varphi = 0$ so that the
measurement is of the $Y$ quadrature, i.e.\ we measure the imaginary part of
$\ket{\Psi_a} = \ket{\alpha e^{-i\nu Tm}}$ for a result
%
\begin{equation}
  \langle c^\dagger c - d^\dagger d\rangle =  2\kappa
  |\alpha||\beta|\left\langle\sin(\nu T S_z)\right\rangle.
\end{equation}
%
For a short pulse of light, the interrogation time will be the lifetime of the
photons in the cavity, $T = \kappa^{-1}$. In this r\'egime we can expand sine
to first order, so that
%
\begin{equation}
  \langle c^\dagger c - d^\dagger d\rangle = 2|\alpha||\beta|
  \frac{g^2}{\Delta}\langle S_z\rangle.
  \label{eqn:homomeas}
\end{equation}

It is now clear that performing the homodyne measurement is equivalent to
performing a measurement of the $S_z$ operator for the spins. We will want to
know the uncertainty of the spin measurement ($\Delta_{S_z}$), and how it
relates to the uncertainty in the homodyne measurement ($\Delta_\eta$). The two
can be linked by considering the expectation value $\langle (c^\dagger c -
d^\dagger d)^2 \rangle$.
We follow a similar procedure to finding $\langle c^\dagger c - d^\dagger d
\rangle$, as well as the commutation relation $[a,a^\dagger] = 1$ (and
equivalent for $b$) to obtain
%
\begin{equation}
  \langle (c^\dagger c - d^\dagger d)^2 \rangle = (2|\alpha||\beta|
  \frac{g^2}{\Delta})^2\langle S_z^2\rangle + |\alpha|^2+|\beta|^2.
\end{equation}

The uncertainties are now related by
%
\begin{align}
  \Delta_\eta^2 &= \langle (c^\dagger c - d^\dagger d)^2 \rangle - \langle
  c^\dagger c - d^\dagger d\rangle \\
  &= (2|\alpha||\beta| \frac{g^2}{\Delta})^2(\langle S_z^2\rangle - \langle
  S_z\rangle^2) - |\alpha|^2 - |\beta|^2 \\
  \Delta_{S_z}^2 &\approx
  \left(\frac{\Delta_\eta/|\beta|}{2|\alpha|g^2/\Delta}\right)^2
  \label{squeeze:eqn:homouncert}
\end{align}
%
where in the last line we have used the approximations $|\beta| \gg |\alpha|$
and $|\beta|\gg 1$.

\section{Entangled states in the ensemble}

% TODO
In this section I will describe how the tools discussed above can be employed
to generate entangled states on a molecule chip. In particular I will focus on
the generation of squeezed states, where correlation between spin states
induces a reduced uncertainty in some component of the ensemble spin.~\cite{}
Such states are useful in quantum metrology, such as in clocks~\cite{} \cm{list
of other things...}

% TODO
\cm{
Need to consider dephasing of spins, some spins collapsing on measurement
(shrinking the Bloch sphere) and the uncertainty associated with the
measurement.
}

\subsection{QND measurement to squeeze the ensemble}
\label{squeeze:QNDsqueeze}

Up to this point we have demonstrated that a QND measurement of $m$ can be
performed via homodyne measurement of the light exiting the cavity. We
therefore proceed with the introduction of an associated measurement projector
that acts directly on the spin state. We will now present a simple case, where
the spin state can be determined exactly, before introducing a realistic
projector in the next section. We will see that both of these measurements will
lead to the production of a squeezed state.

In this toy model, we say that the outcome of this measurement is $\meas{m}$,
so the projector is
%
\begin{equation}
  \Upsilon_0(\meas{m}) = \ket{S, \meas{m}}\bra{S, \meas{m}}.
\end{equation}

In general, the state of a system following a measurement
is~\cite{gerry_knight_2004}
%
\begin{equation}
  \ket{\text{result}} = \frac{\Upsilon\ket{\Psi}}{\sqrt{P_\text{result}}}
  \label{squeeze:eqn:projresult}
\end{equation}
%
where $\Upsilon$ is the relevant projector, and
%
\begin{equation}
  P_\text{result} = \bra{\Psi}\Upsilon\ket{\Psi}
\end{equation}
%
is the probability of determining this result, ensuring that
$\ket{\text{result}}$ is normalised.

Hence, such a QND measurement performed on the state $\ket{\Psi(0)} =
\ket{+}$ produces the state
%
\begin{equation}
  \ket{\Psi_{\meas{m}}} = \ket{S, \meas{m}}
\end{equation}
%
where $\meas{m}$ is the eigenvalue of $S_z$ that was the outcome of our
measurement, obtained with probability $P(\meas{m})$. This is of course what we
expect of our perfect measurement.

It is of note that $\ket{\Psi_{\meas{m}}}$ is a Dicke
state~\cite{Baertschi2019}, the sum of all states with $N_e = \meas{m} + N/2$
spins in the excited state, and $N_g = N - N_e$ spins in the ground state.  We
can write this in terms of the set $\Pi$ of combinations of $N_e$ numbers
chosen from $[1,N]\cap\mathbb{Z}$, as
%
\begin{equation}
  \ket{\Psi_{\meas{m}}} = \binom{N}{N_e}^{-\frac{1}{2}}\sum_{\pi \in \Pi}
  \bigotimes_{i=1}^{N_e} \sigma_x^{\pi_i} \ket{g}.
\end{equation}

To borrow an example from reference~\cite{Cox2016}, consider the case with
$N=4$, $\meas{m}=0$ so we have $N_e = N_g = 2$. Then the state is
%
\begin{equation}
  \ket{\Psi_0} = \frac{1}{\sqrt{6}}(\ket{eegg} + \ket{egeg} + \ket{egge} +
  \ket{geeg} + \ket{gege} + \ket{ggee})
\end{equation}
%
which is a maximally entangled state, represented on the Bloch sphere as a ring
around the equator.
%
Such a state necessarily has zero uncertainty in $S_z$, since this is the
operator that has been measured. The state is therefore maximally squeezed and also
has maximum uncertainty in $S_x$.

With this idealised measurement, it is therefore possible to generate a maximally
squeezed state, simply by performing QND measurement on $\ket{+}$. The state
that is produced will be entangled (unless $\meas{m} = \pm S$). We know the
state we have produced by looking at the value of $\meas{m}$, but have no
control over this outcome, for this reason the squeezing is referred to as
conditional squeezing.
%
We expect for large $N$ that $|\meas{m}|/N \ll 1$, so it is likely that the
state will have $m$ close to zero.

\subsection{Realistic squeezing with QND measurement}

In the event that the homodyne measurement is not perfect, what is the state
that we are in? If the uncertainty associated with the measurement is smaller
than the standard quantum limit, then we expect that we are somewhere between
the maximally squeezed state and the CSS, so that some squeezing has
occurred.
%
The associated projector is~\cite{MAURODARIANO2003205, Vanner16182, Cox2016}
%% NOTE Don't bother citing Zhang2019 because it just cites this Vanner paper
%
\begin{equation}
  \Upsilon(\meas{m}) = \frac{1}{\sqrt{\pi\Delta_N^2}}\exp\left[
    -\frac{(S_z-\meas{m})^2}{2\Delta_{S_z}^2}\right].
\end{equation}
%
This operator represents a measurement where we have some Gaussian uncertainty
($\Delta_{S_z}$) in the measured result, which we found in
\myeqref{squeeze:eqn:homouncert} is directly related to the uncertainty of the
homodyne measurement.

The final spin state will once again be given by
\myeqref{squeeze:eqn:projresult}. Begin by calculating the numerator, that is
the homodyne projector acting on $\ket{\Psi(T)}$
%
\begin{equation}
  \ket{\Psi_{\meas{m}}} = \Upsilon(\meas{m})\ket{\Psi(T)} =
  \sum_{m=-S}^{S}\sqrt{P(m)}\Upsilon(\meas{m})\ket{S,m}\ket{\alpha e^{-i\nu Tm}}.
\end{equation}
%
At this point we drop the ket representing the state of the light. Although we
have a QND measurement on the spins, this process destroys the light state, and
so it is no longer relevant. Therefore we have
%
\begin{equation}
  \ket{\Psi_{\meas{m}}} = 
  \frac{1}{\sqrt{\pi\Delta_N^2}}\sum_{m=-S}^S \sqrt{P(m)} \exp\left[
    -\frac{(m-\meas{m})^2}{2\Delta_N^2}\right]\ket{S,m}.
\end{equation}
%
Which we can immediately use to find the probability of measuring $\meas{m}$
%
%TODO Fix probability noomenclature throughout
\begin{align}
  \tilde{P}(\meas{m}) &= \bra{\Psi(T)}\Upsilon(\meas{m})\ket{\Psi(T)}\\
  & = \sum_{m'=-S}^S \sum_{m=-S}^S \sqrt{P(m')P(m)}\bra{S,
  m'}\Upsilon(\meas{m})\ket{S, m} \\
  & = \sum_{m'=-S}^S \sum_{m=-S}^S \sqrt{P(m')P(m)}
  \frac{1}{\sqrt{2\pi\Delta_{S_z}^2}}\exp\left[-\frac{(m-\meas{m})^2}{2\Delta_{S_z}^2}\right] 
  \bra{S, m'}\ket{S, m} \\
  &= \sum_{m=-S}^{S} P(m) 
  \frac{1}{\sqrt{2\pi\Delta_{S_z}^2}}\exp\left[-\frac{(m-\meas{m})^2}{2\Delta_{S_z}^2}\right] .
\end{align}
%
taking the large $N$ limit, and approximating the summation as an integral,
this last equality becomes a convolution of two Gaussians, so that
%
\begin{equation}
  \tilde{P}(\meas{m}) = \frac{1}{\sqrt{2\pi(\Delta_N^2 + \Delta_{S_z}^2)}}\exp\left[
    -\frac{\meas{m}^2}{2(\Delta_N^2 + \Delta_{S_z}^2)}\right].
\end{equation}
%
This becomes eqn.~\ref{eqn:CSSmprob} in the limit that $\Delta_{S_z} \to 0$
i.e., when the uncertainty in the homodyne detection is small we measure the
state $m$ according to its expected distribution. If we have some large
uncertainty in our measurement then the distribution that we measure is not the
same as the expected distribution.

Finally we calculate the state resulting from the measurement using
myeqref{squeeze:eqn:projresult}, again taking the
approximation that we are in the limit of large $N$, and also that
$\Delta_{S_z}^2 \ll \Delta_N^2$,
%
\begin{equation}
  \ket{\Psi_{\meas{m}}} =
  \sum_{m=-S}^S\left\{\frac{1}{\sqrt{2\pi\Delta_{S_z}^2}} \exp\left[-\frac{(m -
  \meas{m})^2}{2\Delta_{S_z}^2}\right]\right\}^\frac{1}{2} \ket{S,m}
\end{equation}
%
% TODO Better fig. and reference
which is a state that has been squeezed in comparison to the initial spin state
$\ket{+}$ as in \myeqref{squeeze:eqn:plusdicke}. The $S_z$ distribution now has
a width $\Delta_{S_z}^2$ rather than $\Delta_N^2$, as illustrated in
fig~\ref{squeeze:fig:blochsqueezed}. Since the Heisenberg uncertainty principle
must be obeyed, the reduction of uncertainty in $S_z$ increases the uncertainty
in $S_y$.

\begin{figure}
  \centering
  % TODO
  \ph{Figure showing a max squeezed state and comparison between CSS and SSS.}
  \caption{TODO}
  \label{squeeze:fig:blochsqueezed}
\end{figure}

The squeezing is parameterised by the Wineland criterion~\cite{}
%
\begin{equation}
  \chi^2 = \left(\frac{\sqrt{N}/2}{\Delta S_z}\frac{|S|}{N/2}^2\right)^2
\end{equation}
%
where the first fraction inside the brackets is the ratio of the projection
noise to the reduced uncertainty, and the second fraction accounts for any
decoherence that occurs during the measurement. Decoherence or loss of
particles will result in a decrease in the length of the Bloch vector $|S|$,
and hence reduce the precision of a measurement. Hence any useful squeezing
must reduce such effects. The squeezing that can be achieved on a \CaF{}
molecule chip will be explored in the next section.

\section{Implementation on CaF chip}

For our two-level system in CaF choose the states $\ket{g} = \ket{N=0, F=1,
m_F=1}$ and $\ket{e} = \ket{1, 2, 2}$ for their long lifetime in a magnetic
trap. The transition has frequency $\omega_0/2\pi = \SI{20.5}{\giga\hertz}$
\cite{WilliamsMagnetic2018}. The idea is to use a high $Q$ microwave cavity on the
chip, with the molecules magnetically trapped near to an antinode to maximise
the coupling. This is similar to the proposal made by Andr\'e et
al.~\cite{Andre2006}, who also discuss the idea of using a cavity for QND
measurement, although not specifically for the creation of entangled states.

The Rabi frequency is $\Omega = 2g = \mathbf{d}.\mathbf{E}/\hbar$ where $\mathbf{d}$
is the dipole moment of the transition, and $\mathbf{E}$ is the electric field
strength. However, this local electric field is a function of the geometry. We
must calculate it by calculating the field from our particular resonator, and
the molecule's relative position to it. Since this calculation is a little
involved, let's just for now take the conservative coupling estimate from
reference~\cite{Andre2006}, which is for a CaBr positioned
\SI{1}{\micro\meter} from the resonator: $g/2\pi = \SI{40}{\kilo\hertz}$.

A typical superconducting microwave cavity will have a quality factor
$Q\sim10^6$. We can choose the cavity resonance to be similar to the
transition)frequency, so that the cavity loss rate is $\kappa/2\pi =
\omega_0/(2\pi Q) \sim \SI{1}{\kilo\hertz}$. 

The procedure to create entangled states on the chip would be as follows:

\begin{enumerate}
  \item Load CaF molecules in $\ket{g}$ into the magnetic trap close to the
    resonator
  \item Use external microwaves (from e.g. a horn) to transfer the molecules
    into CSS $(\ket{e} + \ket{g})/\sqrt{2}$
  \item Bias the trap so as to achieve large molecule-cavity detuning
  \item Weakly probe the cavity to identify the transmission peak
  \item Determine $N$, which tells us something about the nature of the
    squeezed state that has been produced
  \item Un-bias the qubit for precision quantum measurement or other operation
\end{enumerate}

\section{Outlook}

\subsection{QND readout expanded}

\cm{QND to measure aribtrary states, as in Andr\'e paper.}

\subsection{Superradiance}

\subsection{Cat states}

\subsection{Two-mode squeezing}

% https://journals.aps.org/pra/pdf/10.1103/PhysRevA.99.012325
