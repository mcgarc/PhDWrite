% TODO
%\cm{Need to check this intro, but it is dependent on the context of this and
%previous chapters, so revisit later.}
%In the previous chapter I described how a microwave resonator can be used for
%coherent control of a strongly-coupled ensemble of cold molecules. Now I will
%expand on this to demonstrate how such a system can be used for the creation of
%non-classical states for use in quantum metrology \cm{etc...}
%
%I will begin with a description of the interaction of a spin ensemble with
%light in a cavity. I will then show that using such a system it is possible to
%entangle the spin state of the ensemble with the light exiting the cavity.
%Measuring the light state therefore provides a means of measuring the spin
%state whilst maintaing coherence of the spins. I will go on to show that
%performing such a measurement can be used to generate an entangled spin state,
%with emphasis on the spin squeezed state.

\cm{Intro spiel -- spin squeezed states are the best thing since sliced bread}

\section{Spin states of the ensemble}

\cm{TODO: more spiel}

\subsection{Coherent spin states}

For an ensemble of $N$ spin-half particles, we label the Pauli matrices and the
ladder operators for the $i^\text{th}$ spin as $\sigma_*^i$. The spin operator
for this particle is then
%
\begin{equation}
  \mathbf{s}^i = \frac{1}{2}\begin{bmatrix} \sigma^i_x \\ \sigma^i_y \\ \sigma^i_z
\end{bmatrix}.
\end{equation}
%
We now define the collective spin operator
%
\begin{equation}
  \mathbf{S} = \sum_{i=1}^N \mathbf{s}^i.
\end{equation}
%
The common eigenstates of $\mathbf{S}$ and $S_z$ are the familiar angular
momentum eigenstates, which we label $\ket{S,m_S}$, so that $S^2 \ket{S,m} =
S(S+1)\ket{S, m}$ and $S_z \ket{S,m} = m\ket{S, m}$. These are the so-called
Dicke states~\cite{}, which we will see shortly are entangled states of the
spin system.

Consider how we can write down the total state of the system. For an individual
spin, the state can be written as
%
\begin{equation}
  \ket{\psi(\theta, \phi)}_i = \cos\left(\frac{\theta_i}{2}\right)\ket{e}_i +
  e^{i\phi_i}\sin\left(\frac{\theta_i}{2}\right)\ket{g}_i.
  \label{eqn:blochspin}
\end{equation}
%
It is common to represent such a state visually by the Bloch sphere.
The angles $\theta_i$ and $\phi_i$ define a point on a sphere of unit
radius with $\ket{e}_i$ and $\ket{g}_i$ at the poles. The cartesian
representation is given by the expectation value $\langle \mathbf{s}_i
\rangle$.
%
The state of the ensemble is then
%
\begin{equation}
  \ket{\Psi} = \bigotimes_{i=1}^N \ket{\psi}_i
\end{equation}
%
and the Bloch sphere representation is given by the sum of the individual spin
vectors, as illustrated in \cm{TODO}.

An important case is that of the coherent spin state (CSS), that is a
state when all the spins are aligned, so that for all $i$, $\theta_i = \theta$
and $\phi_i = \phi$~\cite{MA201189, Gazeau2009}.
It is useful to consider a system where all spins are initially
in, for example, the ground state. They then undergo the same uniform rotation
into the desired state $\ket{\psi(\theta, \phi)}_i$, which we write as
%
\begin{equation}
  \ket{\Psi(\theta,\phi)} = \mathcal{R}(\theta, \phi)\ket{g}
\end{equation}
%
where $\ket{g} = \bigotimes_{i=1}^N\ket{g}_i$ and similarly for $\ket{e}$. We
represent this visually on the Bloch sphere, now with radius $S=N/2$, in
analogy with the single spin case, as illustrated in \cm{TODO}. Again
we can represent the vector in a cartesian form as the expectation value
$\langle \mathbf{S} \rangle$. 
%
We note now that $\ket{g} = \ket{S,-S}$ and $\ket{e}=\ket{S,S}$.

% TODO Are ladder operators s_\pm defined elsewhere?
% TODO Cite Binney
% Page 205 onwards in Biney has a discussion of this for N=2 and general S(->J)
%The raising and lowering operators are $S_\pm = (S_x \pm iS_y)/2 =
%\sum_{i=1}^Ns_\pm^i$. It is instructive to consider the state
%when all spins are in the ground state

In the next section, we will make particular use of the state
%
\begin{equation}
  \ket{+} = \bigotimes_{i=1}^N \ket{+}_i.
\end{equation}
%
Such a state can be represented on the Bloch sphere as a line pointing along
the $x$ axis ($\theta=\pi/2$, $\phi=0$), as in \cm{ref fig TODO}, or can be
found in terms of $\ket{S,m}$. A CSS can be written in the form 
%
\begin{equation}
  \ket{\Psi} = \sum_{m=-S}^S a_m \ket{S, m}
\end{equation}
%
with the general form of $a_m$ given in \inlineref{PhysRevA.6.2211}. We will
consider only $\ket{+}$, where the probability amplitudes can be understood as
a probabilty of measuring $m_S$ to be some value $\meas{m}$.

For any individual spin, the chances of measuring it to be in $\ket{e}_i$ or
$\ket{g}_i$ are equal. Measuing the state to be in the state $\ket{S, \meas{m}}$
is equivalent to measuring $N_e$ molecules in the excited state, and $N_g = N -
N_e$ in the ground state such that $2\meas{m} = N_e - N_g$ (although note that
we do not determine which spin is in which state). It follows that the
probability of measuring the state to be $\ket{S,\meas{m}}$ will occur with a
binomial probability~\cite{Gazeau2009}
%
% TODO Fix when I use meas{m} and just m
\begin{equation}
  P(m) = \frac{1}{2^N} \binom{N}{m+N/2}
\end{equation}
%
or for large $N$, the binomial is approximated by the Gaussian
%
\begin{equation}
  P(m) \approx\frac{1}{\sqrt{2\pi \Delta_N^2}} e^{-m^2/(2\Delta_N^2)}.
  \label{eqn:CSSmprob}
\end{equation}
%
where the variance is $\Delta_N^2 = N/4$. We therefore rewrite the probability
amplitudes of $\ket{+}$ so that
%
\begin{equation}
  \ket{+} = \sum_{m=-S}^S \sqrt{P(m)}\ket{S,m}.
  \label{squeeze:eqn:plusdicke}
\end{equation}

Note that such a state has expectation values $\langle S_z \rangle = 0$,
$\langle S_z^2\rangle = \Delta_N^2$, and the uncertainty in $S_z$ is consistent
with the usual formula $\Delta_N^2 = \langle S_z^2 \rangle - \langle
S_z\rangle^2$. This uncertainty is the projection noise of a CSS, arising from
the uncertainty in the measurement of the individual spins. We can understand
this in terms of an uncertainty in the cartesian Bloch vector $\langle
\mathbf{S} \rangle$, or as an uncertainty in $\theta$~\cite{PhysRevA.47.3554}
%
% TODO Un-footnote this
\footnote{This can be shown geometrically: consider the angle on the Bloch
sphere between the x-axis and the arrow representing the CSS, call this
$\theta'$ and assume it to be small. Then $\sin
\theta' \approx \tan \theta' = m/S \approx \theta'$. Differentiating both sides
with respect to theta gives $\Delta m / \Delta \theta \approx 1/S$, noting that
$\Delta \theta' = \Delta \theta$.
}
%
\begin{equation}
  \Delta\theta = \frac{1}{\sqrt{N}}
\end{equation}
which is known as the standard quantum limit (SQL). By symmetry $\Delta \phi =
\Delta \theta$ (corresponding to uncertainty in $S_y$).
%
\cm{Introuduce term `shot-noise'?}

\cm{Check this makes sense...}
Note that these uncertainties hold only for $\ket{+}$ and other states where
$\theta = \pi$ (states on the equator of the Bloch sphere). For example in the
cases of $\ket{e}$ and $\ket{g}$, $\Delta \theta = 0$~\cite{PhysRevA.47.3554}.

\subsection{Spin-squeezed states}

As noted above, the idea of a SSS is to reduce the uncertainty of one component
of $\mathbf{S}$ at the expense of another that we do not care about. Thus we
are able to achieve an uncertainty below the SQL. This is readily exemplified by
a maximally-squeezed state, where the uncertainty is reduced as far as
possible. An example of this continues our discussion of $\ket{+}$ from the
previous section.

Suppose that we are able to prepare the spin state $\ket{+}$ and then measure
$S_z$. As previously described, we will measure $\ket{S, \meas{m}}$ with some
probability $P(\meas{m})$. It is useful to frame such a measurement in a
projector formalism. In general, the state of a system following a measurement
is~\cite{gerry_knight_2004}
%
\begin{equation}
  \ket{\text{result}} = \frac{\Upsilon\ket{\Psi}}{\sqrt{P_\text{result}}}
  \label{squeeze:eqn:projresult}
\end{equation}
%
where $\Upsilon$ is a projector into the measured state, and
%
\begin{equation}
  P_\text{result} = \bra{\Psi}\Upsilon\ket{\Psi}
\end{equation}
%
is the probability of determining this result, ensuring that
$\ket{\text{result}}$ is normalised. In the case of measuring $S_z$ perfectly
to be $\meas{m}$ the projector is 
%
\begin{equation}
  \Upsilon_0(\meas{m}) = \ket{S, \meas{m}}\bra{S, \meas{m}}.
\end{equation}
%
which, as discussed already, yields $\ket{S,\meas{m}}$ with probability
$P(\meas{m})$.

At this point it is worth pointing out that if we can realise such a
measurement then we are done. The Dicke states are entangled states with a
reduced uncertainty (except for $\ket{g}$ and $\ket{e}$). \cm{CHECK THIS!} The
Dicke states can be found by repeated application of the ladder operators, and
are the superposition of all possible states with $N_e$ atoms in $\ket{e}$ and 
$N_g = N - N_e$ atoms in $\ket{g}$. We can therefore write in general that
%
\begin{equation}
  \ket{\frac{N}{2}, m} = \binom{N}{N_e}^{-\frac{1}{2}}\sum_{\pi \in \Pi}
  \bigotimes_{i=1}^{N_e} \sigma_x^{\pi_i} \ket{g}
\end{equation}
%
with $N_e=(N/2)+m$.
%
This is perhaps more easily explored by example, which we can 
borrow from~\inlineref{Cox2016}. Consider the case where
$N=4$ and $\meas{m}=0$. This results in the state $\ket{2, 0}$ which is
%
\begin{equation}
  \ket{2,0} = \frac{1}{\sqrt{6}}(\ket{eegg} + \ket{egeg} + \ket{egge} +
  \ket{geeg} + \ket{gege} + \ket{ggee}).
\end{equation}
%
Note that every possible combination of two excited, and two ground state spins
appear in equal superposition. We can now see that this state is 
maximally entangled state, and would be represented on the Bloch sphere as a ring
around the equator.
%
Such a state necessarily has zero uncertainty in $S_z$, since this is the
operator that has been measured. The state is therefore maximally squeezed and
also has maximum uncertainty in $S_x$.
%
\cm{Need to say something about H'berg at some point, probably (far) above.}
%
Hence we have demonstrated that a measurement of $\ket{+}$ can produce a SSS.

\cm{A note on the fact that it is entanglement (spin-correlations) that reduce
  the uncertainty WITH CITE.}

\cm{Applying a
rotation to the entire ensemble can manipulate the state to lie along any axis
and can be used for precise quantum measurements. }

Measuring $m$ exactly produces a maximally squeezed state, but precise
determination of this value is not always possible, but measuring $m$ with some
uncertainty $\Delta m < \Delta_N$ will still produce a state with reduced
uncertainty in $S_z$, as illustrated in \cm{fig. TODO and CITE}. Here the
measurement projector is
~\cite{MAURODARIANO2003205, Vanner16182, Cox2016}
%% NOTE Don't bother citing Zhang2019 because it just cites this Vanner paper
%
\begin{equation}
  \Upsilon_{\Delta_{S_z}}(\meas{m}) = \frac{1}{\sqrt{\pi\Delta_N^2}}\exp\left[
    -\frac{(S_z-\meas{m})^2}{2\Delta_{S_z}^2}\right].
\end{equation}
%
representing a measurement where we have some Gaussian uncertainty
($\Delta_{S_z}$) in the measured result.  In the next section we will see how
to implement this measurement in a \CaF{} chip system to create squeezed
states.

\section{Spin ensemble in a cavity}

\subsection{Spin Hamiltonian}

We are interested in the case where there are $N\gg1$ spins in the
cavity. Assume that the coupling between each spin and the resonator photons is
the same (that is, the coupling is homogeneous), then the ensemble is described
by the Tavis-Cummings Hamiltonian~\cite{Kirton2019}
%
\begin{equation}
  H_\text{TC}=  \hbar \omega_c a^\dagger a + \sum_{i=1}^N\left[
    \frac{\hbar\omega_0}{2}\sigma_z^i +\frac{\hbar\Omega}{2\sqrt{N}}(a^\dagger
    \sigma^i_- + a\sigma^i_+)\right]
\end{equation}
%
in direct analogy to~\myeqref{theory:eqn:JCH}, where $\sigma_*^i$ to refers
to the pauli or ladder operator acting on the $i^\text{th}$ spin.
\cm{Maybe I defined this already above?}
%
% TODO Why introduce then immediately re-write?
Now rewrite the Hamiltonian for the ensemble as
%
\begin{equation}
  H_\text{TC} = \hbar\omega_c a^\dagger a + \hbar\omega_0 S_z +
  \frac{\hbar\Omega}{2}(a^\dagger S_- + aS_+).
\end{equation}
%
We will once again consider the dispersive r\'egime ($|\Delta|\gg g$). We apply
the transformation by unitary operator
%
\begin{equation}
  U_\text{E} = \exp \left[\frac{g}{\Delta}(aS_+ - a^\dagger S_-)\right]\
\end{equation}
%
for Hamiltonian
%
\begin{equation}
  H_\text{E}= U_\text{E}H_\text{TC}U_\text{E}^\dagger \approx 
    \hbar \omega_c a^\dagger a + 
    \hbar\left(\omega_c + \frac{g^2}{\Delta}\right)S_z + 
    \frac{\hbar g^2}{\Delta}S_z a^\dagger a.
  \label{eqn:He}
\end{equation}
%
This is an extension of the transformation (\myeqref{mws:eqn:Utransform}) and 
resulting Hamiltonian (\myeqref{mws:eqn:UHU}) for the single-molecule case.

This extension is valid since the mathematics of the transformation is exactly
the same as for the single-spin case. The operator $\mathbf{S}$ has the same
commutation relations as the analogous $\mathbf{s}^i$. Once again, the final
term will allow the information transfer for our QND measurements.

\subsection{Quantum non-demolition measurement of the spin state}

We now apply the readout method described for a single spin in
section~\ref{mws:readout} to performing a quantum non-demolition (QND)
measurement of the ensemble state.

In general, the QND measurement is a useful tool in quantum information
processing, which allows the the inspection of the state of a system  while
preserving some quantum coherence~\cite{}.
% TODO Does this next sentence really fit here?
%
In this case we propose that the measurement can be used to prepare squeezed
states of the molecule ensemble.
%
We will show that the state of the system can be entangled with light in the
resonator, in exact analgogy with the single-molecule case. Measurement of this
light can \cm{reduce the uncertainty in some quantum number}.

We assume that the molecules can be prepared in the state $\ket{+}$ by the
normal \cm{mw spectroscopy techniques}. The state of the spins at time $t=0$ is
then
%
\begin{equation}
  \ket{\Psi(0)} = \sum_{m=-S}^S \sqrt{P(m)} \ket{S, m}\ket{\alpha}
\end{equation}
%
which evolves during the interaction with the resonator over a time $T$ to
%
\begin{equation}
  \ket{\Psi(T)} = \exp\left(-iH_\text{int}T/\hbar\right)\ket{\Psi(0)}
\end{equation}
%
where the interaction Hamiltonian is
%
\begin{equation}
  H_\text{int} = \hbar \frac{g^2}{\Delta} S_z a^\dagger a.
\end{equation}
%
After the pulse, we therefore have the state
%
\begin{equation}
  \ket{\Psi(T)} = \sum_{m=-S}^S \sqrt{P(m)} e^{-i\nu T S_z
  a^\dagger a} \ket{S, m}\ket{\alpha}
\end{equation}
%
with $\nu = g^2/\Delta$. It is now straightforward to show that
the state of the spin ensemble is entangled with the state of the light field,
in analogy to equations~\ref{mws:eqn:evolve1}--\ref{mws:eqn:entangled}
%
\begin{align}
  \ket{\Psi(T)} &= e^{-\frac{|\alpha|^2}{2}}\sum_{m=-S}^S \sum_{n=0}^\infty \sqrt{P(m)}
   \frac{\alpha^n}{\sqrt{n!}} e^{-i\nu T S_z a^\dagger a} \ket{S, m} \ket{n}
   \\
  &= e^{-\frac{|\alpha|^2}{2}}\sum_{m=-S}^S \sum_{n=0}^\infty \sqrt{P(m)}
  \frac{\alpha^n}{\sqrt{n!}} e^{-i\nu Tm n} \ket{S, m} \ket{n} \\
  &= \sum_{m=-S}^S \sqrt{P(m)} \ket{S, m} \left( e^{-\frac{|\alpha|^2}{2}}
  \sum_{n=0}^\infty \frac{(\alpha e^{-i\nu T m})^n}{\sqrt{n!}}\ket{n}\right)
  \\
  &= \sum_{m=-S}^S \sqrt{P(m)} \ket{S, m}\ket{\alpha e^{-i\nu T m}}.
\end{align}

It is now clear measuring the phase of the light leaving the cavity
(for example with a homodyne detector) will tell us something about
the state of the ensemble. Notably, the information gained tells us only about
the entire state of the ensemble, and not about any individual spins. Therefore
the quantum coherence is conserved throughout this process.
% TODO I'm not convinced by this assertion. CITE? Actually check... 

\subsection{Homodyne measurement}

The phase of the light is again extracted by the homodyne measurement, which
was described in section~\ref{mws:readout}. We will once again assume short
interaction time so that $T\approx\kappa^{-1}$ and take the strong dispersive
limit ($|\Delta| \gg g^2/\kappa$). The difference in photon numbers arriving at
the homodyne detectors is therefore related to the spin ensemble by
%
\begin{equation}
  \langle c^\dagger c - d^\dagger d\rangle = 2|\alpha||\beta|
  \frac{g^2}{\Delta}\langle S_z\rangle.
  \label{eqn:homomeas}
\end{equation}

It is clear that performing the homodyne measurement is equivalent to
performing a measurement of the $S_z$ operator for the spins. We will want to
know the uncertainty of the spin measurement ($\Delta_{S_z}$), and how it
relates to the uncertainty in the homodyne measurement ($\Delta_\eta$). The two
can be linked by considering the expectation value $\langle (c^\dagger c -
d^\dagger d)^2 \rangle$.
We follow a similar procedure to finding $\langle c^\dagger c - d^\dagger d
\rangle$, as well as the commutation relation $[a,a^\dagger] = 1$ (and
equivalent for $b$) to obtain
%
\begin{equation}
  \langle (c^\dagger c - d^\dagger d)^2 \rangle = (2|\alpha||\beta|
  \frac{g^2}{\Delta})^2\langle S_z^2\rangle + |\alpha|^2+|\beta|^2.
\end{equation}

The uncertainties are now related by
%
\begin{align}
  \Delta_\eta^2 &= \langle (c^\dagger c - d^\dagger d)^2 \rangle - \langle
  c^\dagger c - d^\dagger d\rangle \\
  &= (2|\alpha||\beta| \frac{g^2}{\Delta})^2(\langle S_z^2\rangle - \langle
  S_z\rangle^2) - |\alpha|^2 - |\beta|^2 \\
  \Delta_{S_z}^2 &\approx
  \left(\frac{\Delta_\eta/|\beta|}{2|\alpha|g^2/\Delta}\right)^2
  \label{squeeze:eqn:homouncert}
\end{align}
%
where in the last line we have used the approximations $|\beta| \gg |\alpha|$
and $|\beta|\gg 1$.

% TODO TODO TODO I added this section but not sure it makes sense in structure
% any more?
\section{Entangled states in the ensemble}

% TODO
In this section I will describe how the tools discussed above can be employed
to generate entangled states on a molecule chip. In particular I will focus on
the generation of squeezed states, where correlation between spin states
induces a reduced uncertainty in some component of the ensemble spin.~\cite{}
Such states are useful in quantum metrology, such as in clocks~\cite{} \cm{list
of other things...}

% TODO
\cm{
Need to consider dephasing of spins, some spins collapsing on measurement
(shrinking the Bloch sphere) and the uncertainty associated with the
measurement.
}

\subsection{QND measurement to squeeze the ensemble}
\label{squeeze:QNDsqueeze}

Up to this point we have demonstrated that a QND measurement of $m$ can be
performed via homodyne measurement of the light exiting the cavity. We
therefore proceed with the introduction of an associated measurement projector
that acts directly on the spin state. We will now present a simple case, where
the spin state can be determined exactly, before introducing a realistic
projector in the next section. We will see that both of these measurements will
lead to the production of a squeezed state.

In this toy model, we say that the outcome of this measurement is $\meas{m}$,
so the projector is
%
\begin{equation}
  \Upsilon_0(\meas{m}) = \ket{S, \meas{m}}\bra{S, \meas{m}}.
\end{equation}

In general, the state of a system following a measurement
is~\cite{gerry_knight_2004}
%
\begin{equation}
  \ket{\text{result}} = \frac{\Upsilon\ket{\Psi}}{\sqrt{P_\text{result}}}
  \label{squeeze:eqn:projresult}
\end{equation}
%
where $\Upsilon$ is the relevant projector, and
%
\begin{equation}
  P_\text{result} = \bra{\Psi}\Upsilon\ket{\Psi}
\end{equation}
%
is the probability of determining this result, ensuring that
$\ket{\text{result}}$ is normalised.

Hence, such a QND measurement performed on the state $\ket{\Psi(0)} =
\ket{+}$ produces the state
%
\begin{equation}
  \ket{\Psi_{\meas{m}}} = \ket{S, \meas{m}}
\end{equation}
%
where $\meas{m}$ is the eigenvalue of $S_z$ that was the outcome of our
measurement, obtained with probability $P(\meas{m})$. This is of course what we
expect of our perfect measurement.

It is of note that $\ket{\Psi_{\meas{m}}}$ is a Dicke
state~\cite{Baertschi2019}, the sum of all states with $N_e = \meas{m} + N/2$
spins in the excited state, and $N_g = N - N_e$ spins in the ground state.  We
can write this in terms of the set $\Pi$ of combinations of $N_e$ numbers
chosen from $[1,N]\cap\mathbb{Z}$, as
%
\begin{equation}
  \ket{\Psi_{\meas{m}}} = \binom{N}{N_e}^{-\frac{1}{2}}\sum_{\pi \in \Pi}
  \bigotimes_{i=1}^{N_e} \sigma_x^{\pi_i} \ket{g}.
\end{equation}

To borrow an example from reference~\cite{Cox2016}, consider the case with
$N=4$, $\meas{m}=0$ so we have $N_e = N_g = 2$. Then the state is
%
\begin{equation}
  \ket{\Psi_0} = \frac{1}{\sqrt{6}}(\ket{eegg} + \ket{egeg} + \ket{egge} +
  \ket{geeg} + \ket{gege} + \ket{ggee})
\end{equation}
%
which is a maximally entangled state, represented on the Bloch sphere as a ring
around the equator.
%
Such a state necessarily has zero uncertainty in $S_z$, since this is the
operator that has been measured. The state is therefore maximally squeezed and also
has maximum uncertainty in $S_x$.

With this idealised measurement, it is therefore possible to generate a maximally
squeezed state, simply by performing QND measurement on $\ket{+}$. The state
that is produced will be entangled (unless $\meas{m} = \pm S$). We know the
state we have produced by looking at the value of $\meas{m}$, but have no
control over this outcome, for this reason the squeezing is referred to as
conditional squeezing.
%
We expect for large $N$ that $|\meas{m}|/N \ll 1$, so it is likely that the
state will have $m$ close to zero.

\subsection{Realistic squeezing with QND measurement}

In the event that the homodyne measurement is not perfect, what is the state
that we are in? If the uncertainty associated with the measurement is smaller
than the standard quantum limit, then we expect that we are somewhere between
the maximally squeezed state and the CSS, so that some squeezing has
occurred.
%
The associated projector is~\cite{MAURODARIANO2003205, Vanner16182, Cox2016}
%% NOTE Don't bother citing Zhang2019 because it just cites this Vanner paper
%
\begin{equation}
  \Upsilon(\meas{m}) = \frac{1}{\sqrt{\pi\Delta_N^2}}\exp\left[
    -\frac{(S_z-\meas{m})^2}{2\Delta_{S_z}^2}\right].
\end{equation}
%
This operator represents a measurement where we have some Gaussian uncertainty
($\Delta_{S_z}$) in the measured result, which we found in
\myeqref{squeeze:eqn:homouncert} is directly related to the uncertainty of the
homodyne measurement.

The final spin state will once again be given by
\myeqref{squeeze:eqn:projresult}. Begin by calculating the numerator, that is
the homodyne projector acting on $\ket{\Psi(T)}$
%
\begin{equation}
  \ket{\Psi_{\meas{m}}} = \Upsilon(\meas{m})\ket{\Psi(T)} =
  \sum_{m=-S}^{S}\sqrt{P(m)}\Upsilon(\meas{m})\ket{S,m}\ket{\alpha e^{-i\nu Tm}}.
\end{equation}
%
At this point we drop the ket representing the state of the light. Although we
have a QND measurement on the spins, this process destroys the light state, and
so it is no longer relevant. Therefore we have
%
\begin{equation}
  \ket{\Psi_{\meas{m}}} = 
  \frac{1}{\sqrt{\pi\Delta_N^2}}\sum_{m=-S}^S \sqrt{P(m)} \exp\left[
    -\frac{(m-\meas{m})^2}{2\Delta_N^2}\right]\ket{S,m}.
\end{equation}
%
Which we can immediately use to find the probability of measuring $\meas{m}$
%
%TODO Fix probability noomenclature throughout
\begin{align}
  \tilde{P}(\meas{m}) &= \bra{\Psi(T)}\Upsilon(\meas{m})\ket{\Psi(T)}\\
  & = \sum_{m'=-S}^S \sum_{m=-S}^S \sqrt{P(m')P(m)}\bra{S,
  m'}\Upsilon(\meas{m})\ket{S, m} \\
  & = \sum_{m'=-S}^S \sum_{m=-S}^S \sqrt{P(m')P(m)}
  \frac{1}{\sqrt{2\pi\Delta_{S_z}^2}}\exp\left[-\frac{(m-\meas{m})^2}{2\Delta_{S_z}^2}\right] 
  \bra{S, m'}\ket{S, m} \\
  &= \sum_{m=-S}^{S} P(m) 
  \frac{1}{\sqrt{2\pi\Delta_{S_z}^2}}\exp\left[-\frac{(m-\meas{m})^2}{2\Delta_{S_z}^2}\right] .
\end{align}
%
taking the large $N$ limit, and approximating the summation as an integral,
this last equality becomes a convolution of two Gaussians, so that
%
\begin{equation}
  \tilde{P}(\meas{m}) = \frac{1}{\sqrt{2\pi(\Delta_N^2 + \Delta_{S_z}^2)}}\exp\left[
    -\frac{\meas{m}^2}{2(\Delta_N^2 + \Delta_{S_z}^2)}\right].
\end{equation}
%
This becomes eqn.~\ref{eqn:CSSmprob} in the limit that $\Delta_{S_z} \to 0$
i.e., when the uncertainty in the homodyne detection is small we measure the
state $m$ according to its expected distribution. If we have some large
uncertainty in our measurement then the distribution that we measure is not the
same as the expected distribution.

Finally we calculate the state resulting from the measurement using
\myeqref{squeeze:eqn:projresult}, again taking the
approximation that we are in the limit of large $N$, and also that
$\Delta_{S_z}^2 \ll \Delta_N^2$,
%
\begin{equation}
  \ket{\Psi_{\meas{m}}} =
  \sum_{m=-S}^S\left\{\frac{1}{\sqrt{2\pi\Delta_{S_z}^2}} \exp\left[-\frac{(m -
  \meas{m})^2}{2\Delta_{S_z}^2}\right]\right\}^\frac{1}{2} \ket{S,m}
\end{equation}
%
% TODO Better fig. and reference
which is a state that has been squeezed in comparison to the initial spin state
$\ket{+}$ as in \myeqref{squeeze:eqn:plusdicke}. The $S_z$ distribution now has
a width $\Delta_{S_z}^2$ rather than $\Delta_N^2$, as illustrated in
fig~\ref{squeeze:fig:blochsqueezed}. Since the Heisenberg uncertainty principle
must be obeyed, the reduction of uncertainty in $S_z$ increases the uncertainty
in $S_y$.

\begin{figure}
  \centering
  % TODO
  \ph{Figure showing a max squeezed state and comparison between CSS and SSS.}
  \caption{TODO}
  \label{squeeze:fig:blochsqueezed}
\end{figure}

The squeezing is parameterised by the Wineland criterion~\cite{}
%
\begin{equation}
  \chi^2 = \left(\frac{\sqrt{N}/2}{\Delta S_z}\frac{|S|}{N/2}^2\right)^2
\end{equation}
%
where the first fraction inside the brackets is the ratio of the projection
noise to the reduced uncertainty, and the second fraction accounts for any
decoherence that occurs during the measurement. Decoherence or loss of
particles will result in a decrease in the length of the Bloch vector $|S|$,
and hence reduce the precision of a measurement. Hence any useful squeezing
must reduce such effects. The squeezing that can be achieved on a \CaF{}
molecule chip will be explored in the next section.

\section{Implementation on CaF chip}

For our two-level system in CaF choose the states $\ket{g} = \ket{N=0, F=1,
m_F=1}$ and $\ket{e} = \ket{1, 2, 2}$ for their long lifetime in a magnetic
trap. The transition has frequency $\omega_0/2\pi = \SI{20.5}{\giga\hertz}$
\cite{WilliamsMagnetic2018}. The idea is to use a high $Q$ microwave cavity on the
chip, with the molecules magnetically trapped near to an antinode to maximise
the coupling. This is similar to the proposal made by Andr\'e et
al.~\cite{Andre2006}, who also discuss the idea of using a cavity for QND
measurement, although not specifically for the creation of entangled states.

The Rabi frequency is $\Omega = 2g = \mathbf{d}.\mathbf{E}/\hbar$ where $\mathbf{d}$
is the dipole moment of the transition, and $\mathbf{E}$ is the electric field
strength. However, this local electric field is a function of the geometry. We
must calculate it by calculating the field from our particular resonator, and
the molecule's relative position to it. Since this calculation is a little
involved, let's just for now take the conservative coupling estimate from
reference~\cite{Andre2006}, which is for a CaBr positioned
\SI{1}{\micro\meter} from the resonator: $g/2\pi = \SI{40}{\kilo\hertz}$.

A typical superconducting microwave cavity will have a quality factor
$Q\sim10^6$. We can choose the cavity resonance to be similar to the
transition)frequency, so that the cavity loss rate is $\kappa/2\pi =
\omega_0/(2\pi Q) \sim \SI{1}{\kilo\hertz}$. 

The procedure to create entangled states on the chip would be as follows:

\begin{enumerate}
  \item Load CaF molecules in $\ket{g}$ into the magnetic trap close to the
    resonator
  \item Use external microwaves (from e.g. a horn) to transfer the molecules
    into CSS $(\ket{e} + \ket{g})/\sqrt{2}$
  \item Bias the trap so as to achieve large molecule-cavity detuning
  \item Weakly probe the cavity to identify the transmission peak
  \item Determine $N$, which tells us something about the nature of the
    squeezed state that has been produced
  \item Un-bias the qubit for precision quantum measurement or other operation
\end{enumerate}

\section{Outlook}

\subsection{QND readout expanded}

\cm{QND to measure aribtrary states, as in Andr\'e paper.}

\subsection{Superradiance}

\subsection{Cat states}

\subsection{Two-mode squeezing}

% https://journals.aps.org/pra/pdf/10.1103/PhysRevA.99.012325
